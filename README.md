### Kotlin 中的协程
##### 在网上搜「协程是什么」
* 协程就像一种轻量级的线程
* 协程很像线程，但它不是线程
* 协程「用户态」的，它的切换不需要和操作系统交互，因此协程切换的成本比线程切换低
* 协程由于是「协作式」的，所以不需要线程的同步操作
* 协程是一种在程序中处理并发任务的方案；也是这种方案的一个组件
* 协程和线程属于一个层级的概念，操作系统中处理并发任务，要么用线程要么用协程
##### Kotlin 中的协程
然而 Kotlin 的协程不需要关心这些，因为 JVM 提供解决并发任务的方案是线程，所以其他基于 JVM 的语言都只能使用线程这种方案来解决并发任务。  
所以 Kotlin 的协程并不属于广义的协程，而是一个线程框架，就像 Java 中的 Executor。  
[维基百科](https://en.wikipedia.org/wiki/Coroutine)
##### 协程的代码怎么写
* 用 launch() 来开启一段协程，一般需要指定 Dispatchers.Main
* 把要在后台工作的函数，写成 suspend 函数，需要在内部调用其他 suspend 函数来真正切换线程。
* 按照一条线写下来，线程会自动切换

1. 基本写法
2. 和线程写法对比
3. 协程的优点：在同一个代码块里进行多次的线程切换
4. 等待其他任务
5. 与 Retrofit、LifeCycle、ViewModel、LiveData、Room 结合

##### 协程泄漏

##### delay() 和 Thread.sleep()

##### suspend

###### 什么是挂起
一个稍后会被切回来的线程切换。切回来的动作在协程里面叫做恢复（resume）。挂起函数要么在协程里面调用，要么在挂起函数里面调用。

###### 语法上的作用
提醒：函数的创建者对函数的调用者的提醒。提醒别人这是一个被自动放在后台运行的耗时函数，需要在协程里面被调用。
suspend 本身不会切线程，线程切换的工作需要其他挂起函数执行，比如 withContext。

###### 什么时候使用？
耗时函数：IO 耗时，CPU 计算耗时

###### 非阻塞式挂起
「非阻塞式」意思是不卡线程。
用看起来同步的方式写出异步代码。

##### 协程的额外天然优势：性能
* 程序什么时候会需要切线程
    * 工作比较耗时：放在后台
    * 工作比较特殊：放在指定线程——一般来说，主线程

  不确定哪些代码耗时,我们写函数时放到 Context 中并加上 suspend 关键字。
* 不用协程可以吗？切走，关键是如何切回来

##### 总结
1. 协程是什么？—— 线程框架
2. 优点是什么？ —— 能在同一个代码块里进行多次的线程切换，用看起来同步的方式写出异步代码
3. 什么时候使用？ —— 需要切线程或者指定线程的时候
4. 协程性能更高吗？—— 本质上不会，甚至可能会更差；但实际上会，因为 suspend 的标记功能会避免将耗时操作放到主线程


消除回调

// API 1：获取用户头像

api.getAvatar(user)

// API 2: 获取用户所在公司的 logo

api.getCompanyLogo(user)

需求：分别执行两次网络请求,然后把结果合并后展示到界面。
理论上：同时发起请求
回调式开发比较困难





